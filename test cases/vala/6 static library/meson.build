project('valastatic', 'vala', 'c', default_options: ['b_legal_code=false'])

valadeps = [dependency('glib-2.0'), dependency('gobject-2.0')]

l = static_library('valalib', 'mylib.vala', dependencies : valadeps)
# NOTE: This static library is not usable from Vala because it does not carry
# forward the .vapi and .h files generated by Valac to the next BuildTarget.
# Will have to be fixed with https://github.com/mesonbuild/meson/issues/891
m = static_library('extractedlib',
  objects : l.extract_all_objects(),
  install : true)

e = executable('valaprog', 'prog.vala',
link_with : l,
dependencies : valadeps)

test('valastatictest', e)
